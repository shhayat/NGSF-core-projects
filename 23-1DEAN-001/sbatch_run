###################
#BOWTIE ALIGNMENT
###################
for i in {33..43}
do
  sbatch 03_bowtie_alignment.sh "D23000${i}" "D23000${i}.fastq.gz"
  sleep 0.2
done

########
#PICARD
########
for i in {33..43}
#for i in 41 42
do
  sbatch 04_picard_dedup_and_rm_blacklist_reads.sh "D23000${i}"
  sleep 0.3
done

#########################
#QC: phantompeakqualtools
#########################
for i in {33..43}
do
  sbatch 05_QC_phantompeakqualtools.sh "D23000${i}"
  sleep 0.5
done
###############
#QC: deeptools
###############
DIR=/globalhome/hxo752/HPC/ngsf_git_repos/NGSF-core-projects/23-1DEAN-001/analysis/alignment
label1="BT549_control_rep1 BT549_control_rep2 BT549_control_rep3 BT549_CREB3L1_rep2 BT549_CREB3L1_rep3"
bam_files=""
for num in {33..37}
do  
    sample=$DIR/D23000${num}/D23000${num}.aligned_dedup_filt_sort.bam
    bam_files+="${sample}"
    bam_files=$(echo "$bam_files" | sed 's/.bam\//.bam \//g')
done
sbatch 06_QC_deeptools.sh "${bam_files}" "${label1}" "BT549"; 

DIR=/globalhome/hxo752/HPC/ngsf_git_repos/NGSF-core-projects/23-1DEAN-001/analysis/alignment
label2="HCC1806_ctrl_R1 HCC1806_ctrl_R2 HCC1806_ctrl_R3 HCC1806_CREB3L1_R1 HCC1806_CREB3L1_R2 HCC1806_CREB3L1_R2" 
bam_files=""
for num in {38..43}
do  
    sample=$DIR/D23000${num}/D23000${num}.aligned_dedup_filt_sort.bam
    bam_files+="${sample}"
    bam_files=$(echo "$bam_files" | sed 's/.bam\//.bam \//g')
done
sbatch 06_QC_deeptools.sh "${bam_files}" "${label2}" "HCC1806"; 

##################
#MAC3 Peakcalling
##################
#!/bin/sh
while read control treat sample_name; 
do
    sbatch 07_MACS3_peakcalling.sh "$control" "$treat" "$sample_name";
    sleep 0.3
done < 'samplesheet_BT549.txt'

#!/bin/sh
while read control treat sample_name; 
do
    sbatch 07_MACS3_peakcalling.sh "$control" "$treat" "$sample_name";
    sleep 0.3
done < 'samplesheet_HCC1806.txt'



##################
# IDR
##################
DIR=/globalhome/hxo752/HPC/ngsf_git_repos/NGSF-core-projects/23-1DEAN-001/analysis/peakcall

peak_files=""
for peak_file in $DIR/SRR*/*_peaks.sorted.narrowPeak
do  
    peak_files+="${peak_file}"
    peak_files=$(echo "$peak_files" | sed 's/.narrowPeak\//.narrowPeak \//g')
 done
 
sbatch 08_IDR_handling_replicates.sh  "${peak_files}";
